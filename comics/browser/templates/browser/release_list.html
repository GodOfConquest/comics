{% extends "base.html" %}
{% load cache %}


{% block title %}
  {{ title|safe }}
{% endblock %}


{% block extra_head %}
  {{ block.super }}
  {% if feed_url %}
    <link rel="alternate" type="application/atom+xml"
      href="{{ feed_url }}"
      title="{{ feed_title }}">
  {% endif %}
  {% if first_url %}
    <link rel="start" href="{{ first_url }}">
    <link rel="first" href="{{ first_url }}">
  {% endif %}
  {% if prev_url %}
    <link rel="prev" href="{{ prev_url }}">
  {% endif %}
  {% if next_url %}
    <link rel="next" href="{{ next_url }}">
  {% endif %}
  {% if last_url %}
    <link rel="last" href="{{ last_url }}">
  {% endif %}
{% endblock %}


{% block content %}

  <div class="page-header">
    {% if feed_url %}
      <div class="btn-group pull-right">
        <a href="{{ feed_url }}"
          title="{{ feed_title }}" class="btn btn-default navbar-btn">
          <i class="icon-rss"></i> Feed</a>
      </div>
    {% endif %}

    <h1>
      {{ title|safe }}
      {% if subtitle %}
        <small>{{ subtitle|safe }}</small>
      {% endif %}
    </h1>
  </div>

  <div class="browser-menu">
    {% include "browser/menu.html" %}
  </div>

  {% ifequal object_type 'mycomics' %}
    {% ifequal view_type 'latest' %}
      <div class="alert alert-info new-releases-alert">
        <strong class="new-release-count">0</strong> new release(s) available.
        <a href="{% url "mycomics_latest" %}">Show</a>
      </div>
    {% endifequal %}
  {% endifequal %}

  <div id="releases">
    {% for release in release_list %}

      <div class="release panel panel-default"
        data-comic="{{ release.comic.slug }}" data-release-id="{{ release.id }}">
        <div class="panel-heading">
          <div class="pull-right">
            <span class="pub_date">{{ release.pub_date }}</span>

            {% if release.comic not in my_comics %}
              <form action="{% url "toggle_comic" %}" method="post"
                class="mycomics-toggle pull-right">
                {% csrf_token %}
                <input type="hidden" name="comic"
                  value="{{ release.comic.slug }}">
                <button type="submit" name="add_comic"
                  title="Add to my comics"
                  class="btn btn-default btn-xs mycomics-add">
                  <span class="action">
                    <i class="icon-plus"></i>
                    Add to my comics
                  </span>
                  <span class="success">
                    <i class="icon-ok icon-white"></i>
                    Added to my comics
                  </span>
                </button>
              </form>
            {% endif %}
          </div>

          <h2 class="panel-title float-left">
            <a href="{{ release.get_absolute_url }}">
              {{ release.comic.name }}
            </a>
          </h2>
        </div>

        {% cache 3600 'release' release.id %}
          {% include "browser/release_content.html" %}
        {% endcache %}

      </div>

    {% empty %}

      {% ifequal object_type 'mycomics' %}
        <div class="alert alert-info">
          <strong>No comics found in my comics.</strong>
          You can browse available comics below.
          {% url "import_named_set" as import_named_set_url %}
          {% if import_named_set_url %}
            Alternatively, you can
            <a href="{{ import_named_set_url }}">import an old comic set</a>.
          {% endif %}
        </div>
      {% endifequal %}

      {% ifequal object_type 'onecomic' %}
        <div class="alert alert-info">
          <strong>No releases found for this comic.</strong>
          You can browse other available comics below.
        </div>

        {% if user.is_superuser %}
          <div class="alert alert-danger">
            <strong>To the site admin:</strong>
            You can fetch releases by running:
            <code>python manage.py comics_getreleases</code>
          </div>
        {% endif %}
      {% endifequal %}

    {% endfor %}
  </div>

{% endblock %}
